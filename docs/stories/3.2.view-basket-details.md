# Story 3.2: View Basket Details

## Status

Approved

## Story

**As a** user,
**I want** to view the detailed contents and philosophy of a specific "Basket,"
**so that** I can make an informed decision before investing.

## Acceptance Criteria

1. The "Basket Detail View" displays the Basket's name, a short description, and its risk level (e.g., Low, Medium, High).
2. The screen lists all the individual assets contained within the "Basket," showing each with its logo and percentage allocation.
3. A simple, non-technical chart visualizes the "Basket's" historical performance.
4. The view includes a clear "Power Up" button to initiate an investment.

## Tasks / Subtasks

- [ ] Create Basket Detail Screen Component (AC: 1, 2, 4)
  - [ ] Create `BasketDetailScreen` component in appropriate screen directory
  - [ ] Implement TypeScript interfaces for detailed basket data
  - [ ] Display basket name, description, and risk level
  - [ ] Create asset allocation list component
  - [ ] Add "Power Up" button with proper styling
  - [ ] Implement responsive layout for different screen sizes

- [ ] Asset Allocation Display (AC: 2)
  - [ ] Create `AssetAllocationCard` component
  - [ ] Display individual asset logos and names
  - [ ] Show percentage allocation for each asset
  - [ ] Implement proper spacing and visual hierarchy
  - [ ] Add loading states for asset data

- [ ] Performance Chart Implementation (AC: 3)
  - [ ] Research and integrate chart library (react-native-chart-kit or similar)
  - [ ] Create simple line chart for historical performance
  - [ ] Implement non-technical, user-friendly chart styling
  - [ ] Add time period selectors (1W, 1M, 3M, 1Y)
  - [ ] Handle chart data loading and error states

- [ ] Backend API Integration (AC: 1, 2, 3)
  - [ ] Create API service for fetching basket details
  - [ ] Implement basket performance data fetching
  - [ ] Add error handling for API requests
  - [ ] Handle loading states during data fetching
  - [ ] Integrate with existing API Gateway structure

- [ ] Navigation Integration (AC: 4)
  - [ ] Set up navigation from basket list to detail view
  - [ ] Handle navigation parameters (basket ID)
  - [ ] Implement proper back navigation
  - [ ] Add navigation to investment flow from "Power Up" button

- [ ] Data Management & State (AC: 1, 2, 3)
  - [ ] Extend Zustand store for basket details
  - [ ] Implement caching strategy for basket details
  - [ ] Add refresh functionality for basket data
  - [ ] Handle real-time performance updates

- [ ] UI/UX Implementation (AC: 1, 2, 3, 4)
  - [ ] Apply design system styling from design.json
  - [ ] Implement risk level visual indicators
  - [ ] Create performance chart styling
  - [ ] Add proper typography and spacing
  - [ ] Implement loading skeletons for better UX

- [ ] Testing Implementation
  - [ ] Write unit tests for BasketDetailScreen component
  - [ ] Write unit tests for AssetAllocationCard component
  - [ ] Write integration tests for API service
  - [ ] Write chart rendering tests
  - [ ] Write navigation tests
  - [ ] Write accessibility tests

## Dev Notes

### Previous Story Context

From Story 3.1:
- Basket list navigation established
- Basic basket data structure implemented
- API integration patterns established
- Design system integration patterns

### Data Models

**Extended Basket Data Structure** [Source: architecture/data-models.md#basket]:
```typescript
model Basket {
  id            String    @id @default(cuid())
  name          String
  description   String
  iconUrl       String?
  riskLevel     RiskLevel @default(MEDIUM)
  assets        Json      // Contains asset allocation data
  isCommunity   Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  curator       User?     @relation("CuratedBy", fields: [curatorId], references: [id])
  curatorId     String?
  holdings      PortfolioHolding[]
  schedules     InvestmentSchedule[]
  autoInvestments AutoInvestment[]
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
}
```

**Asset Allocation Structure** (JSON format in assets field):
```typescript
interface AssetAllocation {
  symbol: string;
  name: string;
  logoUrl: string;
  percentage: number;
  currentPrice?: number;
}

interface BasketAssets {
  allocations: AssetAllocation[];
  totalAllocation: number; // Should equal 100
  lastUpdated: string;
}
```

### API Specifications

**Basket Detail Endpoints** [Source: architecture/core-workflows.md]:
- `GET /api/v1/baskets/:id` - Fetch specific basket details
- `GET /api/v1/baskets/:id/performance` - Fetch basket performance data
- `GET /api/v1/baskets/:id/assets` - Fetch detailed asset allocation

**Performance Data Structure**:
```typescript
interface BasketPerformance {
  basketId: string;
  timeframe: '1W' | '1M' | '3M' | '6M' |'1Y';
  dataPoints: {
    date: string;
    value: number;
    percentageChange: number;
  }[];
  totalReturn: number;
  totalReturnPercentage: number;
}
```

### Component Specifications

**Chart Library Integration** [Source: architecture/tech-stack.md]:
- React Native Chart Kit or Victory Native for chart rendering
- Simple line chart for performance visualization
- Non-technical styling with clear visual indicators

**Risk Level Visual Indicators**:
- LOW: Green color (#10B981)
- MEDIUM: Yellow/Orange color (#F59E0B)
- HIGH: Red color (#EF4444)

### File Locations

Based on project structure:
- **Screen Component**: `apps/mobile-app/app/baskets/[id].tsx`
- **Component Library**:
  - `apps/mobile-app/components/baskets/BasketDetailView.tsx`
  - `apps/mobile-app/components/baskets/AssetAllocationCard.tsx`
  - `apps/mobile-app/components/baskets/PerformanceChart.tsx`
- **API Services**: `apps/mobile-app/lib/api/baskets.ts` (extend existing)
- **Store**: `apps/mobile-app/store/basketsStore.ts` (extend existing)
- **Types**: `apps/mobile-app/types/baskets.ts` (extend existing)

### External API Integration

**Polygon.io Integration** [Source: architecture/polygon-integration.md]:
- Real-time stock market data via `/v2/aggs/ticker/{ticker}/prev` endpoint
- Historical performance data via `/v2/aggs/ticker/{ticker}/range/{multiplier}/{timespan}/{from}/{to}`
- Asset pricing updates with 1-minute cache during market hours
- Rate limiting: 5 calls/minute (free tier), implement retry logic with exponential backoff
- Error handling: Fallback to cached data, graceful degradation for missing performance indicators
- Security: API key stored in backend environment variables, never exposed to frontend
- Historical performance data through polygon.io endpoints
- Real-time asset pricing for allocation calculations
- Asset metadata (logos, names) for display

**Chart Data Processing**:
- Transform raw performance data into chart-friendly format
- Calculate percentage changes for visual indicators
- Handle different time periods (1W, 1M, 3M, 6M, 1Y)

### Technical Constraints

**Performance Considerations**:
- Lazy load chart data to improve initial screen load
- Cache performance data to reduce API calls
- Optimize chart rendering for smooth scrolling

**Chart Library Requirements**:
- Must support React Native
- Should handle responsive design
- Must support custom styling to match design system

### Design System Integration

**Colors** [Source: design.json and previous stories]:
- Primary: #5852FF (brand color)
- Text: #000000 (primary text)
- Background: #FFFFFF
- Success: #10B981 (positive performance)
- Warning: #F59E0B (medium risk)
- Error: #EF4444 (negative performance, high risk)

**Typography**:
- Headers: MD Nichrome
- Body text: Gilroy
- Chart labels: Gilroy Regular, smaller sizes

### Security Considerations

- Validate basket ID parameters to prevent injection
- Sanitize performance data before chart rendering
- Proper error handling to prevent data exposure
- Rate limiting for performance data requests

### Accessibility Requirements

- Screen reader support for chart data
- High contrast mode support
- Proper focus management for interactive elements
- Alternative text for asset logos and charts

### Testing Strategy

**Unit Tests**:
- Component rendering with mock data
- Chart data transformation logic
- API service error handling
- Navigation parameter handling

**Integration Tests**:
- Full basket detail flow from navigation
- Chart rendering with real data
- API integration with error scenarios
- Performance data caching behavior

## Change Log

| Date       | Version | Description            | Author       |
| ---------- | ------- | ---------------------- | ------------ |
| 2024-12-19 | 1.0     | Initial story creation | Scrum Master |

## Dev Agent Record

### Agent Model Used

[To be filled by Dev Agent]

### Debug Log References

[To be filled by Dev Agent]

### Completion Notes List

[To be filled by Dev Agent]

### File List

[To be filled by Dev Agent]

## QA Results

[To be filled by QA Agent]
