# Story 3.4: Receive AI Tip Post-Investment

## Status

Draft

## Story

**As a** user,
**I want** to receive a simple, personalized tip from the AI Expert immediately after I make an investment,
**so that** I can learn and feel more confident about my financial decisions.

## Acceptance Criteria

1. Immediately following a successful "Power Up" action, the UI displays a message from the AI Expert.
2. The tip is contextual to the "Basket" the user just invested in (e.g., "Great choice! The 'Gamer Basket' often sees activity around major game releases...").
3. The AI tip is delivered in a non-intrusive way (e.g., a toast notification or a chat bubble).
4. The tip is saved to a user's notification or message history for later review.

## Tasks / Subtasks

- [ ] Create AI Tip Display Component (AC: 1, 3)
  - [ ] Create `AITipNotification` component with chat bubble styling
  - [ ] Implement non-intrusive display mechanism (toast/overlay)
  - [ ] Add AI Expert avatar and branding
  - [ ] Create smooth animation for tip appearance
  - [ ] Add dismiss functionality with gesture support
  - [ ] Implement auto-dismiss timer (optional)

- [ ] AI Tip Generation Service (AC: 2)
  - [ ] Create AI tip generation API endpoint
  - [ ] Implement contextual tip logic based on basket type
  - [ ] Create tip templates for different basket categories
  - [ ] Add personalization based on user investment history
  - [ ] Implement tip relevance scoring
  - [ ] Add fallback tips for edge cases

- [ ] Backend AI Integration (AC: 2)
  - [ ] Integrate with AI Platform (Google Gemini)
  - [ ] Create prompt engineering for investment tips
  - [ ] Implement tip generation workflow
  - [ ] Add tip quality validation and filtering
  - [ ] Create tip caching mechanism
  - [ ] Handle AI service failures gracefully

- [ ] Tip Storage & History (AC: 4)
  - [ ] Extend database schema for expert tips
  - [ ] Create tip storage API endpoints
  - [ ] Implement tip history retrieval
  - [ ] Add tip categorization and tagging
  - [ ] Create user tip interaction tracking
  - [ ] Implement tip search functionality

- [ ] Investment Flow Integration (AC: 1)
  - [ ] Integrate tip display into investment success flow
  - [ ] Trigger tip generation on successful investment
  - [ ] Handle tip loading states during investment
  - [ ] Add tip display to investment confirmation screen
  - [ ] Ensure proper timing of tip delivery

- [ ] Notification System (AC: 3, 4)
  - [ ] Extend existing notification system for AI tips
  - [ ] Create tip notification categories
  - [ ] Implement notification persistence
  - [ ] Add notification history management
  - [ ] Create notification preferences settings

- [ ] UI/UX Implementation (AC: 1, 3)
  - [ ] Apply design system styling for AI Expert branding
  - [ ] Create engaging tip presentation format
  - [ ] Implement proper typography and spacing
  - [ ] Add visual indicators for AI-generated content
  - [ ] Create responsive design for different screen sizes

- [ ] State Management (AC: 1, 3, 4)
  - [ ] Create AI tips store with Zustand
  - [ ] Implement tip display state management
  - [ ] Add tip history state management
  - [ ] Handle tip loading and error states
  - [ ] Create tip interaction tracking

- [ ] Testing Implementation
  - [ ] Write unit tests for AITipNotification component
  - [ ] Write integration tests for tip generation service
  - [ ] Write API endpoint tests
  - [ ] Write tip storage and retrieval tests
  - [ ] Write investment flow integration tests
  - [ ] Write notification system tests

## Dev Notes

### Previous Story Context

From Story 3.3:
- Investment flow completion triggers
- Success confirmation patterns established
- User feedback mechanisms in place
- State management for investment process

### Data Models

**Expert Tip Structure** [Source: architecture/data-models.md]:
```typescript
model ExpertTip {
  id          String   @id @default(cuid())
  content     String
  category    String
  basketId    String?
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  interactions UserTipInteraction[]
}

model UserTipInteraction {
  id        String              @id @default(cuid())
  type      TipInteractionType
  user      User                @relation(fields: [userId], references: [id])
  userId    String
  tip       ExpertTip           @relation(fields: [tipId], references: [id])
  tipId     String
  createdAt DateTime            @default(now())
}

enum TipInteractionType {
  VIEWED
  LIKED
  SHARED
  SAVED
  DISMISSED
}
```

### API Specifications

**AI Tip Endpoints**:
- `POST /api/v1/tips/generate` - Generate contextual tip
- `GET /api/v1/tips/history` - Get user's tip history
- `POST /api/v1/tips/:id/interact` - Record tip interaction
- `GET /api/v1/tips/categories` - Get available tip categories

**Tip Generation Request**:
```typescript
interface TipGenerationRequest {
  userId: string;
  basketId: string;
  investmentAmount: number;
  context: {
    basketName: string;
    basketCategory: string;
    riskLevel: string;
    userInvestmentHistory?: InvestmentSummary[];
  };
}

interface TipGenerationResponse {
  tipId: string;
  content: string;
  category: string;
  relevanceScore: number;
  displayDuration?: number;
}
```

### AI Integration Specifications

**Google Gemini Integration** [Source: architecture/external-apis.md]:
- AI Platform integration for tip generation
- Contextual prompt engineering for investment advice
- Content filtering and validation

**Tip Generation Prompts**:
```typescript
interface TipPromptContext {
  basketName: string;
  basketDescription: string;
  riskLevel: 'LOW' | 'MEDIUM' | 'HIGH';
  investmentAmount: number;
  userExperience: 'BEGINNER' | 'INTERMEDIATE' | 'ADVANCED';
  recentMarketTrends?: string[];
}
```

**Sample Tip Categories**:
- Investment Education
- Market Insights
- Risk Management
- Portfolio Diversification
- Timing and Strategy
- Behavioral Finance

### Component Specifications

**AI Tip Notification Design**:
- Chat bubble style with AI Expert avatar
- Smooth slide-in animation from bottom or side
- Non-blocking overlay that doesn't interrupt user flow
- Clear visual distinction as AI-generated content

**AI Expert Branding**:
- Consistent avatar/icon across all AI interactions
- Brand colors for AI Expert messaging
- Typography that distinguishes AI content
- Friendly, approachable visual design

### File Locations

Based on project structure:
- **Component**: `apps/mobile-app/components/ai/AITipNotification.tsx`
- **AI Service**: `apps/mobile-app/lib/ai/tipGeneration.ts`
- **API Service**: `apps/mobile-app/lib/api/tips.ts`
- **Store**: `apps/mobile-app/store/tipsStore.ts`
- **Types**: `apps/mobile-app/types/tips.ts`

### External API Integration

**AI Platform Integration** [Source: architecture/external-apis.md]:
- Google Gemini API for natural language generation
- Prompt engineering for financial education content
- Content moderation and safety filtering

**Tip Generation Workflow**:
1. Investment completion triggers tip generation
2. Context data sent to AI service
3. AI generates personalized tip content
4. Content validation and filtering
5. Tip stored in database
6. Tip displayed to user with animation
7. User interaction tracked for learning

### Technical Constraints

**AI Service Considerations**:
- API rate limiting and cost management
- Response time optimization for real-time display
- Fallback mechanisms for AI service failures
- Content quality assurance and filtering

**Performance Requirements**:
- Fast tip generation (< 2 seconds)
- Smooth animation performance
- Minimal impact on investment flow completion
- Efficient tip caching and storage

### Design System Integration

**AI Expert Visual Identity**:
- Consistent avatar design across app
- Brand color integration (#5852FF for AI elements)
- Typography hierarchy for tip content
- Visual indicators for AI-generated content

**Notification Styling** [Source: design.json]:
- Chat bubble with rounded corners
- Proper shadow and elevation
- Readable typography with sufficient contrast
- Smooth animation curves for appearance/dismissal

### Content Strategy

**Tip Content Guidelines**:
- Educational and encouraging tone
- Contextual to specific investment made
- Actionable insights when appropriate
- Beginner-friendly language
- Positive reinforcement for good decisions

**Tip Categories by Basket Type**:
- Tech Baskets: Innovation trends, company insights
- Gaming Baskets: Industry cycles, major releases
- ESG Baskets: Impact investing, sustainability trends
- Index Baskets: Diversification benefits, long-term strategy

### Security Considerations

**Content Safety**:
- AI-generated content filtering and validation
- Inappropriate content detection and blocking
- Financial advice disclaimer integration
- User privacy protection in tip personalization

**Data Privacy**:
- Minimal user data sharing with AI service
- Secure storage of tip interaction data
- Compliance with financial data regulations
- User consent for AI-generated recommendations

### Accessibility Requirements

- Screen reader support for AI tip content
- High contrast mode compatibility
- Keyboard navigation for tip interactions
- Alternative text for AI Expert avatar
- Proper focus management for notifications

### Testing Strategy

**Unit Tests**:
- AI tip component rendering and animation
- Tip generation service logic
- Content validation and filtering
- User interaction tracking

**Integration Tests**:
- Complete tip generation and display flow
- AI service integration with mock responses
- Investment flow integration
- Notification system integration

**Content Testing**:
- Tip relevance and quality validation
- A/B testing for tip effectiveness
- User engagement metrics tracking
- Content safety and appropriateness verification

### Performance Monitoring

**Metrics to Track**:
- Tip generation response times
- User engagement with tips (read rates, interactions)
- AI service success/failure rates
- Tip relevance scores and user feedback

**Optimization Strategies**:
- Tip pre-generation for common scenarios
- Caching of frequently requested tips
- Progressive loading for tip history
- Background tip generation during investment processing

## Change Log

| Date       | Version | Description            | Author       |
| ---------- | ------- | ---------------------- | ------------ |
| 2024-12-19 | 1.0     | Initial story creation | Scrum Master |

## Dev Agent Record

### Agent Model Used

[To be filled by Dev Agent]

### Debug Log References

[To be filled by Dev Agent]

### Completion Notes List

[To be filled by Dev Agent]

### File List

[To be filled by Dev Agent]

## QA Results

[To be filled by QA Agent]
